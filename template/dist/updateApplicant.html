<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>ITP - Company Dashboard</title>

    <link rel="stylesheet" href="assets/css/main/app.css">
    <link rel="stylesheet" href="assets/css/main/app-dark.css">
    <link rel="shortcut icon" href="assets/images/logo/favicon.svg" type="image/x-icon">
    <link rel="shortcut icon" href="assets/images/logo/favicon.png" type="image/png">
    <link rel="stylesheet" href="assets/extensions/sweetalert2/sweetalert2.min.css" />

    <style>
        .card-header {
            padding-bottom: 0 !important;
        }

        .theme-dark .swal2-success-circular-line-right,
        .theme-dark .swal2-success-circular-line-left,
        .theme-dark .swal2-success-fix {
            background-color: #1e1e2d !important;
        }
    </style>
</head>

<body>
    <div id="app">
        {# activePage is to determine which item to be active#}
        {% set activePage = "applicant" %}
        {% include "companySidebar.html" %}
        <div id="main" class='layout-navbar'>
            {% include "companyHeader.html" %}
            <div id="main-content">

                <div class="page-heading">
                    <div class="page-title">
                        <div class="row">
                            <div class="col-12 col-md-8 col-lg-8 order-md-1 order-last">
                                <h3>Job Application Detail</h3>
                                <p class="text-subtitle text-muted">Update the Job Application Status here</p>
                            </div>
                            <div class="col-12 col-md-4 col-lg-4 order-md-1 order-last">
                                <div class="d-flex justify-content-end">
                                    <a href="/companyViewApplicant" class="btn btn-primary">Back</a>
                                </div>
                            </div>
                        </div>
                    </div>
                    <div id="main-content">
                        <div class="row">
                            <div class="card">
                                <div class="card-header">
                                    <h4>Application Detail (Application ID:<span id="applicationId"></span>)</h4>
                                </div>
                                <div class="card-content">
                                    <div class="card-body">
                                        <div class="row">
                                            <div class="col-12 col-lg-6 col-md-6">
                                                <h6 class="card-subtitle">Application Date</h6>
                                                <p id="applyDate" class="card-text"></p>
                                            </div>
                                            <div class="col-12 col-lg-6 col-md-6">
                                                <h6 class="card-subtitle">Status</h6>
                                                <p id="applyStatus" class="card-text"></p>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <div class="row">
                            <div class="col-12 col-lg-6 col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h4>Student Details</h4>
                                        <div class="row d-flex justify-content-center">
                                            <div class="col-12 col-lg-4 "><img class="card-img-top"
                                                    id="studentProfile" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <div class="card-body">
                                            <div class="row my-3">
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="card-subtitle">Student ID</h6>
                                                    <p id="studentId" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="card-subtitle">Name </h6>
                                                    <p id="studentName" class="card-text"></p>
                                                </div>
                                            </div>
                                            <div class="row my-3">
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="card-subtitle">Education Level </h6>
                                                    <p id="level" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="card-subtitle">Programme</h6>
                                                    <p id="programme" class="card-text"></p>
                                                </div>
                                            </div>
                                            <div class="row my-3">
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="card-subtitle">Address</h6>
                                                    <p id="studentAddress" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-6">
                                                    <h6 class="card-subtitle">Health Remark </h6>
                                                    <p id="healthRemark" class="card-text"></p>
                                                </div>
                                            </div>
                                            <div class="row my-3">
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Personal Email</h6>
                                                    <a id="personalEmail" class="card-text"></a>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">School Email</h6>
                                                    <a id="schoolEmail" class="card-text"></a>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Contact No</h6>
                                                    <p id="studentContact" class="card-text"></p>
                                                </div>
                                            </div>
                                            <div class="row my-3">
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Gender</h6>
                                                    <p id="studentGender" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Own Transport</h6>
                                                    <p id="ownTransport" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">CGPA</h6>
                                                    <p id="studentCgpa" class="card-text"></p>
                                                </div>
                                            </div>

                                        </div>
                                    </div>
                                </div>
                            </div>
                            <div class="col-12 col-lg-6 col-md-6">
                                <div class="card">
                                    <div class="card-header">
                                        <h4 class="card-title">Job Details</h4>
                                        <div class="row d-flex justify-content-center">
                                            <div class="col-12 col-lg-4 "><img class="card-img-top" id="logoDisplay" />
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-content">
                                        <div class="card-body">

                                            <div class="row my-3">
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Company </h6>
                                                    <p id="companyDisplay" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-8">
                                                    <h6 class="card-subtitle">Job Title </h6>
                                                    <p id="jobTitleDisplay" class="card-text"></p>
                                                </div>
                                            </div>
                                            <div class="row my-3">
                                                <h6 class="card-subtitle">Job Description </h6>
                                                <p id="jobDescriptionDisplay" class="card-text"
                                                    style="white-space: pre-line;"></p>
                                            </div>
                                            <div class="row my-3">
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Allowance </h6>
                                                    <p id="allowanceDisplay" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Working Day</h6>
                                                    <p id="workDayDisplay" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Working Hour </h6>
                                                    <p id="workHourDisplay" class="card-text"></p>
                                                </div>
                                            </div>
                                            <div class="row my-3">
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Accessory Provided </h6>
                                                    <p id="accessoryDisplay" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Accommodation Provided</h6>
                                                    <p id="accomDisplay" class="card-text"></p>
                                                </div>
                                                <div class="col-12 col-lg-4">
                                                    <h6 class="card-subtitle">Open For</h6>
                                                    <p id="openDisplay" class="card-text"></p>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </div>
                        <form class="form" id="updateApplicationForm" data-parsley-validate action="/UpdateApplicantStatus"
                            method="GET">
                            <input type="hidden" name="applicationId" value="{{application.applicationId}}">
                            <div class="row">
                                <div class="card">
                                    <div class="card-header">
                                        <h4>Update Application Status</h4>
                                    </div>
                                    <div class="card-content">
                                        <div class="card-body">
                                            <div class="row">
                                                <div class="col-md-6 mb-4">
                                                    <div class="form-group mb-3 mandatory">
                                                        <label for="remark" class="form-label">Review Remark</label>
                                                        <textarea class="form-control" id="remark" rows="3"
                                                            placeholder="E.g: We have sent an email to you regarding the job interview / The job is full."
                                                            name="remark" data-parsley-required="true"></textarea>
                                                    </div>
                                                </div>
                                                <div class="col-md-6 mb-4">
                                                    <div class="form-group mb-3 mandatory">
                                                        <label for="statusUpdate" class="form-label">Application
                                                            Status</label>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="statusUpdate" value="Approved" id="Approved"
                                                                data-parsley-required="true">
                                                            <label class="form-check-label" for="diploma">
                                                                Approved
                                                            </label>
                                                        </div>
                                                        <div class="form-check">
                                                            <input class="form-check-input" type="radio"
                                                                name="statusUpdate" value="Rejected" id="Rejected">
                                                            <label class="form-check-label" for="degree"
                                                                data-parsley-required="true">
                                                                Rejected
                                                            </label>
                                                        </div>
                                                    </div>
                                                </div>
                                            </div>
                                        </div>
                                    </div>
                                    <div class="card-footer">
                                        <div class="d-flex justify-content-end">
                                            <button type="submit" class="btn btn-primary me-1 mb-1">Update</button>
                                        </div>
                                    </div>
                                </div>
                            </div>
                        </form>

                    </div>
                </div>

                {% include "footer.html" %}
            </div>
        </div>
    </div>
    <script src="assets/js/bootstrap.js"></script>
    <script src="assets/js/app.js"></script>
    <script src="assets/extensions/jquery/jquery.min.js"></script>
    <script src="//code.jquery.com/jquery-3.7.0.js"></script>
    <script src="assets/extensions/parsleyjs/parsley.min.js"></script>
    <script src="assets/js/pages/parsley.js"></script>
    <script src="assets/extensions/sweetalert2/sweetalert2.min.js"></script>

    {% if success %}
    <script>
        Swal.fire({
            icon: 'success',
            title: 'Status Updated',
            text: '{{success}}',
        })
    </script>
    {% endif %}

    <script>
        //if status is not pending, disable the form
        if (`{{application.applicationStatus}}` != "Pending") {
            document.getElementById("updateApplicationForm").innerHTML += "<div class='row'><div class='col-12'><div class='alert alert-warning' role='alert'>You have already Approved or Rejected this application.</div></div></div>";
            $("#updateApplicationForm :input").prop("disabled", true);
        }

        //populate application details to the card
        document.getElementById("applicationId").innerHTML = `{{application.applicationId}}`;
        document.getElementById("applyDate").innerHTML = `{{application.applyDate}}`;
        //display apply status in badge
        document.getElementById("applyStatus").classList.add("badge");
        //if status is pending, display in yellow, if approved, display in green, if rejected, display in red
        if (`{{application.applicationStatus}}` == "Pending") {
            document.getElementById("applyStatus").classList.add("bg-warning");
        } else if (`{{application.applicationStatus}}` == "Approved") {
            document.getElementById("applyStatus").classList.add("bg-success");
        } else if (`{{application.applicationStatus}}` == "Rejected") {
            document.getElementById("applyStatus").classList.add("bg-danger");
        }
        document.getElementById("applyStatus").innerHTML = `{{application.applicationStatus}}`;


        //populate student details to the card
        document.getElementById("studentProfile").src = `{{student.profilePic}}`;
        document.getElementById("studentName").innerHTML = `{{student.name}}`;
        document.getElementById("studentId").innerHTML = `{{student.studId}}`;
        document.getElementById("level").innerHTML = `{{student.eduLvl}}`;
        document.getElementById("programme").innerHTML = `{{student.programme}}`;
        document.getElementById("personalEmail").innerHTML = `{{student.personalEmail}}`;
        document.getElementById("personalEmail").href = "mailto:" + `{{student.personalEmail}}`;
        document.getElementById("schoolEmail").innerHTML = `{{student.studEmail}}`;
        document.getElementById("schoolEmail").href = "mailto:" + `{{student.studEmail}}`;
        document.getElementById("studentContact").innerHTML = `{{student.contactNo}}`;
        if (`{{student.gender}}` == "F") {
            document.getElementById("studentGender").innerHTML = "Female";
        } else if (`{{student.gender}}` == "M") {
            document.getElementById("studentGender").innerHTML = "Male";
        }
        if (`{{student.ownTransport}}` == "Y") {
            document.getElementById("ownTransport").innerHTML = "Yes";
        } else if (`{{student.ownTransport}}` == "N") {
            document.getElementById("ownTransport").innerHTML = "No";
        }
        document.getElementById("studentCgpa").innerHTML = `{{student.latestCgpa}}`;
        document.getElementById("studentAddress").innerHTML = `{{student.permAddr}}`;
        if (`{{student.healthRemark}}` == "") {
            document.getElementById("healthRemark").innerHTML = "None";
        } else {
            document.getElementById("healthRemark").innerHTML = `{{student.healthRemark}}`;
        }

        //populate job details to the card
        document.getElementById("logoDisplay").src = `{{company.logo}}`;
        document.getElementById("companyDisplay").innerHTML = `{{company.companyName}}`;
        document.getElementById("jobTitleDisplay").innerHTML = `{{job.jobTitle}}`;
        document.getElementById("jobDescriptionDisplay").innerHTML = `{{job.jobDesc}}`;
        document.getElementById("allowanceDisplay").innerHTML = `{{job.allowance}}`;
        document.getElementById("workDayDisplay").innerHTML = `{{job.workingDay}}`;
        document.getElementById("workHourDisplay").innerHTML = `{{job.workingHour}}`;
        document.getElementById("accessoryDisplay").innerHTML = `{{job.accessoryProvide}}`;

        document.getElementById("accomDisplay").innerHTML = `{{job.accommodation}}` == "Y" ? "Yes" : "No";
        openFor = "";
        if (`{{job.diploma}}` == "Y") {
            openFor += "Diploma";
        }
        if (`{{job.degree}}` == "Y") {
            if (openFor != "") {
                openFor += " & ";
            }
            openFor += "Degree";
        }
        document.getElementById("openDisplay").innerHTML = openFor;

    </script>

</body>

</html>